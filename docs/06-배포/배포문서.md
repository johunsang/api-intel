# 배포 문서

| 항목 | 내용 |
|------|------|
| **프로젝트명** | API Intelligence Engine |
| **문서 버전** | v2.0 |
| **작성일** | 2026-02-27 |
| **작성자** | 조훈상 / 기획·개발 |
| **문서 상태** | 배포 완료 |

---

## 1. 배포 개요

| 항목 | 내용 |
|------|------|
| 배포 플랫폼 | AWS EC2 (Ubuntu) |
| 이전 플랫폼 | Vercel (2026-02-25 ~ 2026-02-27) |
| 배포 방식 | EC2 인스턴스 SSH 직접 배포 |
| EC2 IP | `43.200.127.245` |
| SSH 키 | `027.pem` |
| OS | Ubuntu |
| Production URL | http://43.200.127.245:3000 |
| 커스텀 도메인 | https://www.vibecodingclass.xyz |
| 배포 일시 | 2026-02-27 |
| 플랫폼 이전 사유 | Vercel → AWS EC2 마이그레이션 |

---

## 2. 기술 스택

| 기술 | 버전 | 용도 |
|------|------|------|
| Next.js | 16.1.6 | App Router 기반 프레임워크 |
| React | 19.2.3 | UI 라이브러리 |
| TypeScript | 5.9.x | 정적 타입 |
| Tailwind CSS | 4.2.x | 스타일링 (다크 테마 기본) |
| Zustand | 5.0.x | 클라이언트 상태 관리 |
| lucide-react | 0.575.x | 아이콘 |
| Turbopack | 내장 | 빌드 번들러 |

---

## 3. 프로젝트 구조

```
apps/web/src/
├── app/                          # Next.js App Router 페이지
│   ├── page.tsx                  # 랜딩 페이지 (/)
│   ├── layout.tsx                # 루트 레이아웃 (GNB + Footer + Toast)
│   ├── globals.css               # 다크 테마 CSS 변수
│   ├── login/page.tsx            # 로그인 (/login)
│   ├── query/
│   │   ├── page.tsx              # 쿼리 입력/결과 (/query)
│   │   ├── query-content.tsx     # 쿼리 클라이언트 컴포넌트
│   │   └── [id]/page.tsx         # 결과 상세 (/query/:id)
│   ├── compare/
│   │   ├── page.tsx              # 비교표 (/compare)
│   │   └── compare-content.tsx   # 비교 클라이언트 컴포넌트
│   ├── history/page.tsx          # 쿼리 이력 (/history)
│   ├── settings/page.tsx         # 설정 (/settings)
│   ├── not-found.tsx             # 404 에러
│   ├── error.tsx                 # 500 에러
│   └── api/                      # API Routes (Mock)
│       ├── auth/login/route.ts
│       ├── auth/logout/route.ts
│       ├── queries/route.ts
│       ├── queries/[id]/route.ts
│       ├── comparisons/route.ts
│       ├── users/me/route.ts
│       └── users/me/usage/route.ts
├── components/
│   ├── ui/                       # 기초 UI 컴포넌트 (14개)
│   ├── layout/                   # GNB, Footer, 모바일 메뉴
│   ├── query/                    # 쿼리 도메인 컴포넌트 (9개)
│   ├── compare/                  # 비교표 컴포넌트
│   ├── history/                  # 이력 컴포넌트
│   └── settings/                 # 설정 탭 컴포넌트
├── hooks/                        # 커스텀 훅 (debounce, clipboard, auto-resize)
├── lib/                          # 유틸리티 (cn, api-client, format, mock-data)
└── store/                        # Zustand 스토어 (auth, query, toast)
```

**총 소스 파일: 63개**

---

## 4. 라우트 목록

| 라우트 | 타입 | 접근 권한 | 설명 |
|--------|------|-----------|------|
| `/` | Static | 전체 | 랜딩 페이지 |
| `/login` | Static | 비인증 | GitHub OAuth 로그인 |
| `/query` | Static | 전체 | 쿼리 입력/결과 (핵심 화면) |
| `/query/[id]` | Dynamic | 전체 | 쿼리 결과 상세 |
| `/compare` | Static | 인증 필수 | API 비교표 |
| `/history` | Static | 인증 필수 | 쿼리 이력 |
| `/settings` | Static | 인증 필수 | 프로필/구독/사용량 설정 |
| `/api/auth/login` | Dynamic | - | POST: Mock 로그인 |
| `/api/auth/logout` | Dynamic | - | POST: 로그아웃 |
| `/api/queries` | Dynamic | - | POST: 쿼리 실행, GET: 이력 조회 |
| `/api/queries/[id]` | Dynamic | - | GET: 상세, DELETE: 삭제 |
| `/api/comparisons` | Dynamic | - | POST: 비교표 생성 |
| `/api/users/me` | Dynamic | - | GET: 프로필, PATCH: 수정 |
| `/api/users/me/usage` | Dynamic | - | GET: 사용량 통계 |

---

## 5. 배포 절차

### 5.1 사전 조건

- Node.js 22.x 이상
- pnpm 패키지 매니저
- AWS CLI 설정 완료
- EC2 인스턴스 SSH 접근 권한

### 5.2 로컬 빌드 확인

```bash
cd apps/web
pnpm install
pnpm build
```

빌드 성공 시 15개 라우트가 생성되어야 한다.

### 5.3 EC2 배포 실행

```bash
# EC2 인스턴스 접속
ssh -i ~/Downloads/027.pem ubuntu@43.200.127.245

# 소스 업데이트
cd /app/api-intel/apps/web
git pull origin main

# 의존성 설치 및 빌드
pnpm install
pnpm build

# Next.js 프로덕션 서버 시작
pnpm start
```

### 5.4 배포 확인

```bash
# 프로세스 확인
pm2 status  # 또는 systemctl status api-intel

# 헬스체크
curl http://localhost:3000
```

### 5.5 (레거시) Vercel 배포 — 참고용

> 2026-02-27 이전 Vercel 배포 시 사용했던 절차. 현재는 사용하지 않음.

```bash
# Preview 배포
vercel --scope 123asdfsfs-projects

# Production 배포
vercel --yes --prod --scope 123asdfsfs-projects
```

---

## 6. 환경 변수

현재 버전은 Mock 데이터 기반이므로 환경 변수가 필요하지 않다.

향후 백엔드 연동 시 필요한 변수:

| 변수명 | 설명 | 예시 |
|--------|------|------|
| `DATABASE_URL` | PostgreSQL 연결 문자열 | `postgresql://...` |
| `GITHUB_CLIENT_ID` | GitHub OAuth 클라이언트 ID | `Iv1.xxx` |
| `GITHUB_CLIENT_SECRET` | GitHub OAuth 시크릿 | `ghs_xxx` |
| `OPENAI_API_KEY` | LLM API 키 | `sk-xxx` |
| `NEXTAUTH_SECRET` | 세션 암호화 키 | `random-string` |
| `NEXTAUTH_URL` | 인증 콜백 URL | `https://www.vibecodingclass.xyz` |

---

## 7. 빌드 결과

```
Route (app)
┌ ○ /
├ ○ /_not-found
├ ƒ /api/auth/login
├ ƒ /api/auth/logout
├ ƒ /api/comparisons
├ ƒ /api/queries
├ ƒ /api/queries/[id]
├ ƒ /api/users/me
├ ƒ /api/users/me/usage
├ ○ /compare
├ ○ /history
├ ○ /login
├ ○ /query
├ ƒ /query/[id]
└ ○ /settings

○  (Static)   정적 사전 렌더링
ƒ  (Dynamic)  서버 사이드 동적 렌더링
```

- TypeScript 오류: **0건**
- 빌드 시간: **약 4초** (Turbopack)
- 정적 페이지 생성: **15개 / 15개** 성공

---

## 8. 주요 기능 동작 확인

| 기능 | 확인 방법 | 예상 결과 |
|------|-----------|-----------|
| 랜딩 페이지 | `/` 접속 | 헤드라인, 쿼리 입력창, 예시 칩, 가치 카드 3개 |
| 예시 쿼리 | 랜딩에서 예시 칩 클릭 | `/query?q=...`로 이동 후 스트리밍 시뮬레이션 |
| 스트리밍 시뮬레이션 | `/query`에서 검색 실행 | analyzing → searching → streaming → complete |
| 결과 상세 | 결과 카드 클릭 | `/query/[id]` 상세 페이지 (조건 테이블, 인용, 링크) |
| 비교 선택 | 결과에서 2개 이상 체크 → 비교하기 | `/compare?ids=...` 비교표 |
| 로그인 | `/login`에서 GitHub 버튼 클릭 | Mock 로그인 후 `/query`로 이동 |
| 인증 가드 | 비로그인 상태에서 `/history` 접근 | `/login`으로 리다이렉트 |
| 이력 검색 | `/history`에서 검색어 입력 | 300ms 디바운스 필터링 |
| 설정 탭 | `/settings`에서 탭 전환 | 프로필/구독/사용량 탭 |
| 404 | 존재하지 않는 URL 접속 | 404 에러 페이지 |

---

## 9. 제한 사항 및 향후 계획

### 현재 제한 사항
- 모든 데이터는 Mock (클라이언트 사이드 하드코딩)
- GitHub OAuth는 Mock 구현 (실제 OAuth 미연동)
- 스트리밍은 setTimeout 기반 시뮬레이션
- 데이터 영속성 없음 (새로고침 시 초기화)

### 향후 배포 시 추가 필요 사항
- PostgreSQL + Drizzle ORM 연동
- GitHub OAuth 실제 연동 (NextAuth.js)
- OpenAI/Anthropic API 연동 (RAG 파이프라인)
- Qdrant 벡터 DB 연동
- SSE 기반 실제 스트리밍 구현
- EC2 환경 변수 설정 (.env.production)
- SSL 인증서 설정 (Let's Encrypt / ACM)
- Nginx 리버스 프록시 구성
- PM2 또는 systemd 프로세스 관리
- CloudWatch 모니터링 설정

---

## 10. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| v1.0 | 2026-02-25 | 조훈상 | 초기 배포 문서 작성, Vercel 프로덕션 배포 완료 |
| v2.0 | 2026-02-27 | 조훈상 | 배포 플랫폼 Vercel → AWS EC2 마이그레이션, 배포 절차 전면 개정 |
